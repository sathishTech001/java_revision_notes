<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interview Revision Tool (Dark Mode & Theme)</title>
    
    <style>
        /* -------------------------------------------------------------------------------------- */
        /* --- 1. CSS VARIABLES (Theme Definitions) --- */
        /* -------------------------------------------------------------------------------------- */
        :root {
            /* Default Light Mode Variables */
            --bg-color: #f4f7f9;
            --main-bg: white;
            --text-color: #333;
            --header-bg: #2c3e50;
            --header-text: white;
            --sidebar-bg: #ecf0f1;
            --card-border: #ddd;
            --highlight-text: #e74c3c;
            --code-bg: #2d2d2d;
            --code-text: #f8f8f2;
            
            /* Default Accent Color (Blue) */
            --accent-color: #3498db;
            --link-hover-bg: #3498db;
        }

        /* Dark Mode Overrides */
        .dark-mode {
            --bg-color: #121212;
            --main-bg: #1e1e1e;
            --text-color: #f0f0f0;
            --header-bg: #000000;
            --header-text: #f0f0f0;
            --sidebar-bg: #252525;
            --card-border: #333;
            --highlight-text: #ff9800; /* Amber for highlights */
            --link-hover-bg: var(--accent-color); /* Use accent color for hover */
        }
        
        /* -------------------------------------------------------------------------------------- */
        /* --- 2. GLOBAL STYLES --- */
        /* -------------------------------------------------------------------------------------- */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .app-container {
            max-width: 1200px;
            margin: 20px auto;
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            background-color: var(--main-bg);
            min-height: 90vh;
            transition: background-color 0.3s;
        }

        /* --- HEADER/MENU STYLES --- */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--header-bg);
            color: var(--header-text);
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        .header-controls button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 4px;
        }

        .menu-button-container {
            position: relative;
        }

        #main-menu {
            position: absolute;
            top: 40px;
            right: 0;
            background-color: var(--main-bg);
            border: 1px solid var(--card-border);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10;
            min-width: 150px;
            display: none; /* Hide by default, JS toggles */
        }

        #main-menu.visible {
            display: block;
        }

        #main-menu a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: var(--text-color);
            border-bottom: 1px solid var(--card-border);
        }

        #main-menu a.active-category {
            background-color: var(--accent-color);
            color: white;
            font-weight: bold;
        }

        /* --- MAIN LAYOUT (SIDEBAR + CONTENT) --- */
        .main-layout {
            display: flex;
            min-height: calc(90vh - 65px);
        }

        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            padding: 20px;
            border-right: 1px solid var(--card-border);
            flex-shrink: 0;
        }
        
        .sidebar h2 {
            margin-top: 0;
            color: var(--header-bg);
            border-bottom: 2px solid #bdc3c7;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        
        .dark-mode .sidebar h2 {
             color: var(--highlight-text);
        }

        .topic-link {
            display: block;
            padding: 10px 5px;
            margin-bottom: 5px;
            background-color: var(--main-bg);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            color: var(--text-color);
            font-weight: bold;
        }

        .topic-link:hover, .topic-link.active {
            background-color: var(--link-hover-bg);
            color: white;
        }
        
        .topic-link.active {
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* --- CONTENT DETAILS STYLES --- */
        .card {
            background-color: var(--main-bg);
            border: 1px solid var(--card-border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .card h3 {
            color: var(--highlight-text);
            margin-top: 0;
            border-bottom: 1px dashed var(--highlight-text);
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        
        .qa-list li {
            border-left: 4px solid var(--accent-color);
            padding-left: 10px;
            margin-bottom: 10px;
        }
        
        pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        
        /* Settings specific styles */
        #settings-page {
            max-width: 500px;
        }
        .setting-control {
            padding: 10px 0;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Hide content initially */
        #topic-details, #settings-page {
            display: none;
        }

        /* Hide mobile-only button on large screens */
        .topic-toggle-mobile {
            display: none;
        }


        /* --- MOBILE LAYOUT (Media Query) --- */
        @media (max-width: 768px) {
            .app-container { margin: 0; box-shadow: none; }
            .main-layout { flex-direction: column; }
            .sidebar { 
                width: 100%; 
                border-right: none; 
                border-bottom: 1px solid var(--card-border); 
            }
            
            /* Show mobile-only button on small screens */
            .topic-toggle-mobile { 
                display: block; 
            }
            
            /* --- Mobile Sidebar Toggle Logic --- */
            /* Collapse sidebar content initially on mobile */
            .sidebar h2, #topic-list-container {
                max-height: 0;
                overflow: hidden;
                padding-top: 0;
                padding-bottom: 0;
                transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            }

            /* Open state for sidebar content */
            .sidebar.open h2, .sidebar.open #topic-list-container {
                max-height: 500px; /* Needs to be large enough to contain content */
                padding-top: 10px;
                padding-bottom: 10px;
            }
            
            /* The main sidebar title should be visible to click when closed */
            .sidebar h2 {
                max-height: none; 
                padding-top: 0;
                padding-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1 id="current-category-title"></h1>
            <div class="header-controls">
                <div class="topic-toggle-mobile">
                    <button id="topic-toggle-btn">Topics</button>
                </div>
                <button id="settings-btn">‚öôÔ∏è Settings</button>
                <div class="menu-button-container">
                    <button id="menu-toggle-btn">Menu ‚ò∞</button>
                    <nav id="main-menu">
                        </nav>
                </div>
            </div>
        </header>

        <div class="main-layout">
            <aside id="topic-sidebar" class="sidebar">
                <h2>Topics</h2>
                <div id="topic-list-container">
                    </div>
            </aside>

            <main id="content-display" class="content">
                <div class="initial-message" id="initial-message">
                    <h3>Welcome to Interview Revision!</h3>
                    <p>Select a category from the top menu, then select a topic from the left sidebar to begin.</p>
                </div>
                
                <section id="settings-page">
                    <h2>‚öôÔ∏è Application Settings</h2>
                    <div class="card" id="settings-card">
                        <div class="setting-control">
                            <label for="theme-toggle"><h3>Dark Mode</h3></label>
                            <input type="checkbox" id="theme-toggle">
                        </div>
                        
                        <div class="setting-control">
                            <label for="accent-color"><h3>Accent Color</h3></label>
                            <input type="color" id="accent-color" value="#3498db">
                        </div>
                        
                        <p style="margin-top: 15px;">* Accent color controls the highlight color for buttons, active links, and Q&A borders.</p>
                        <button onclick="saveSettings()">Save Settings</button>
                    </div>
                </section>

                <section id="topic-details">
                    <h2 id="detail-topic-name"></h2>
                    
                    <div class="card">
                        <h3>Definition</h3>
                        <p id="detail-definition"></p>
                    </div>

                    <div class="card" id="key-points-card">
                        <h3>Interview Key Points</h3>
                        <ul id="detail-key-points" class="key-points-list"></ul>
                    </div>
                    
                    <div class="card" id="qa-card">
                        <h3>Questions & Answers</h3>
                        <ul id="detail-qa" class="qa-list"></ul>
                    </div>

                    <div class="card" id="code-example-card">
                        <h3>Code Example / Usage</h3>
                        <pre><code id="detail-code-example"></code></pre>
                    </div>
                    
                    <div class="card" id="example-card">
                        <h3>General Example</h3>
                        <p id="detail-example"></p>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>

        let interviewData = null; 

        async function loadAndInitialize(url) {
            try {
                // 1. Fetch the data from the external file
                const response = await fetch(url);
                
                // 2. Check if the fetch was successful
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                // 3. Convert the response body to a JavaScript object
                interviewData = await response.json();
                
                // 4. Initialize the rest of the application
                loadSettings(); 
                renderMainMenu();
                
                const firstCategoryKey = Object.keys(interviewData.menu)[0];
                if (firstCategoryKey) {
                    switchCategory(firstCategoryKey);
                } else {
                    document.getElementById('initial-message').style.display = 'block'; 
                }

            } catch (error) {
                console.error("Error loading or parsing JSON data:", error);
                // Display an error message to the user if the data load fails
                document.getElementById('initial-message').innerHTML = `
                    <h3>Data Loading Error!</h3>
                    <p>Could not load interview data. Please ensure 'interviewData.json' is in the correct directory and is valid JSON format.</p>
                    <p>Error details: ${error.message}</p>
                `;
                document.getElementById('initial-message').style.display = 'block'; 
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Start the application by loading the external file
            loadAndInitialize('data.json'); 
        });
        // --------------------------------------------------------------------------------------
        // 2. DOM ELEMENT REFERENCES
        // --------------------------------------------------------------------------------------
        const docBody = document.body;
        const sidebar = document.getElementById('topic-sidebar');
        const topicListContainer = document.getElementById('topic-list-container');
        const menu = document.getElementById('main-menu');
        const contentDetails = document.getElementById('topic-details');
        const settingsPage = document.getElementById('settings-page');
        const initialMessage = document.getElementById('initial-message');
        const menuToggleButton = document.getElementById('menu-toggle-btn');
        const topicToggleButton = document.getElementById('topic-toggle-btn'); // üëà Fixed button
        const settingsButton = document.getElementById('settings-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const accentColorInput = document.getElementById('accent-color');
        const currentCategoryTitle = document.getElementById('current-category-title');
        
        let currentCategoryKey = null; 

        // --------------------------------------------------------------------------------------
        // 3. THEME/SETTINGS FUNCTIONS
        // --------------------------------------------------------------------------------------

        function applyTheme(isDark, accentColor) {
            // Apply Dark Mode Class
            if (isDark) {
                docBody.classList.add('dark-mode');
                themeToggle.checked = true;
            } else {
                docBody.classList.remove('dark-mode');
                themeToggle.checked = false;
            }
            
            // Apply Accent Color Variable
            docBody.style.setProperty('--accent-color', accentColor);
            accentColorInput.value = accentColor;
        }

        function loadSettings() {
            const savedTheme = localStorage.getItem('theme');
            const savedColor = localStorage.getItem('accentColor') || '#3498db';
            
            applyTheme(savedTheme === 'dark', savedColor);
        }

        window.saveSettings = function() {
            const isDark = themeToggle.checked;
            const accentColor = accentColorInput.value;
            
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            localStorage.setItem('accentColor', accentColor);
            
            applyTheme(isDark, accentColor);
            alert('Settings saved successfully!');
        }

        themeToggle.addEventListener('change', () => {
            // Live preview when toggling dark mode
            const isDark = themeToggle.checked;
            if (isDark) {
                 docBody.classList.add('dark-mode');
            } else {
                 docBody.classList.remove('dark-mode');
            }
        });

        accentColorInput.addEventListener('input', (e) => {
            // Live preview when changing color
            docBody.style.setProperty('--accent-color', e.target.value);
        });
        
        // --- Settings Page Display Logic ---
        settingsButton.addEventListener('click', () => {
            // Hide menu if open
            menu.classList.remove('visible');
            
            // Hide everything else and show settings
            initialMessage.style.display = 'none';
            contentDetails.style.display = 'none';
            settingsPage.style.display = 'block';
            
            // Ensure topic sidebar is closed on mobile
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('open');
            }
        });

        // --- Menu Toggle (Top Right) ---
        menuToggleButton.addEventListener('click', () => {
            menu.classList.toggle('visible');
            // Hide settings page if it was open
            if (settingsPage.style.display === 'block') {
                settingsPage.style.display = 'none';
                initialMessage.style.display = 'block';
            }
        });

        // --- Topics Toggle (Mobile Only) ---
        topicToggleButton.addEventListener('click', () => { // üëà FIX: Added event listener
            sidebar.classList.toggle('open');
        });
        
        function showTopicContentArea() {
            settingsPage.style.display = 'none';
            initialMessage.style.display = 'none';
            contentDetails.style.display = 'block';
        }

        // --------------------------------------------------------------------------------------
        // 4. CORE RENDERING FUNCTIONS
        // --------------------------------------------------------------------------------------

        function renderMainMenu() {
            menu.innerHTML = Object.keys(interviewData.menu).map(key => {
                const category = interviewData.menu[key];
                return `<a href="#" data-category-key="${key}">${category.title.toUpperCase()}</a>`;
            }).join('');
            
            menu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const key = e.target.getAttribute('data-category-key');
                    switchCategory(key);
                    menu.classList.remove('visible'); // Hide menu after selection
                });
            });
        }
        
        function switchCategory(key) {
            currentCategoryKey = key;
            const categoryData = interviewData.menu[key];
            
            currentCategoryTitle.textContent = categoryData.title + ' Revision';
            
            // Set active style for menu category
            document.querySelectorAll('#main-menu a').forEach(link => {
                link.classList.remove('active-category');
                if (link.getAttribute('data-category-key') === key) {
                    link.classList.add('active-category');
                }
            });

            renderSidebar(categoryData.topics);
            
            const topicKeys = Object.keys(categoryData.topics);
            const firstTopicKey = topicKeys[0];
            
            if (firstTopicKey) {
                displayTopicContent(key, firstTopicKey);
                // üëà FIX: Explicitly set the active class on the first topic link after rendering
                const firstTopicLink = document.querySelector(`#topic-list-container [data-topic-key="${firstTopicKey}"]`);
                if (firstTopicLink) {
                    firstTopicLink.classList.add('active');
                }
            } else {
                 initialMessage.style.display = 'block'; // Show welcome message if category is empty
                 contentDetails.style.display = 'none';
            }

            showTopicContentArea(); // Show content area when category is switched
        }

        function renderSidebar(topics) {
            topicListContainer.innerHTML = ''; 
            
            Object.keys(topics).forEach(topicKey => {
                const topic = topics[topicKey];
                const link = document.createElement('a');
                link.href = '#';
                link.classList.add('topic-link');
                link.setAttribute('data-topic-key', topicKey);
                link.textContent = topic.title;
                
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    displayTopicContent(currentCategoryKey, topicKey);
                    
                    // Remove active class from all, then add to the clicked one
                    document.querySelectorAll('.topic-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');

                    // Close the sidebar on mobile after a selection
                    if (window.innerWidth <= 768) {
                        sidebar.classList.remove('open');
                    }
                });

                topicListContainer.appendChild(link);
            });
        }

        function displayTopicContent(categoryKey, topicKey) {
            const topic = interviewData.menu[categoryKey].topics[topicKey];

            if (!topic) return;

            showTopicContentArea(); // Ensure settings page is hidden
            
            // 1. Topic Title and Definition
            document.getElementById('detail-topic-name').textContent = topic.title;
            document.getElementById('detail-definition').textContent = topic.definition;

            // 2. Interview Key Points (List)
            const keyPointsList = document.getElementById('detail-key-points');
            keyPointsList.innerHTML = '';
            const keyPointsCard = document.getElementById('key-points-card');
            if (topic.interview_key_points && topic.interview_key_points.length > 0) {
                topic.interview_key_points.forEach(point => {
                    const li = document.createElement('li');
                    li.textContent = point;
                    keyPointsList.appendChild(li);
                });
                keyPointsCard.style.display = 'block';
            } else {
                keyPointsCard.style.display = 'none';
            }
            
            // 3. Questions & Answers (List)
            const qaList = document.getElementById('detail-qa');
            qaList.innerHTML = '';
            const qaCard = document.getElementById('qa-card');
            if (topic.qa && topic.qa.length > 0) {
                topic.qa.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>Q: ${item.q}</strong><br>A: ${item.a}`;
                    qaList.appendChild(li);
                });
                qaCard.style.display = 'block';
            } else {
                qaCard.style.display = 'none';
            }

            // 4. Code Example
            const codeExample = document.getElementById('detail-code-example');
            const codeExampleCard = document.getElementById('code-example-card');
            if (topic.code_example) {
                codeExample.textContent = topic.code_example;
                codeExampleCard.style.display = 'block';
            } else {
                codeExampleCard.style.display = 'none';
            }

            // 5. General Example
            const generalExample = document.getElementById('detail-example');
            const exampleCard = document.getElementById('example-card');
            if (topic.example) {
                generalExample.textContent = topic.example;
                exampleCard.style.display = 'block';
            } else {
                exampleCard.style.display = 'none';
            }
        }

        // --------------------------------------------------------------------------------------
        // 5. INITIALIZATION
        // --------------------------------------------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            loadSettings(); // Load theme and color first
            renderMainMenu();
            
            const firstCategoryKey = Object.keys(interviewData.menu)[0];
            if (firstCategoryKey) {
                switchCategory(firstCategoryKey);
            } else {
                initialMessage.style.display = 'block'; // Show welcome message if no data exists
            }
        });
    </script>
</body>
</html>